<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Hiển thị A1:D1 với ảnh và giỏ hàng</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(loadData);

    let sanPham = {}; // Để lưu thông tin sản phẩm đang hiển thị

    function loadData() {
      const query = new google.visualization.Query(
        'https://docs.google.com/spreadsheets/d/1EUdSLPDwBC92X-3s9hjLPcsmyPpsE7xMYk7nBv4TWsM/gviz/tq?sheet=Sheet1'
      );
      query.setQuery('SELECT A, B, C, D LIMIT 1');
      query.send(handleQueryResponse);
    }

    function handleQueryResponse(response) {
      if (response.isError()) {
        document.getElementById('output').textContent = 'Lỗi: ' + response.getMessage();
        return;
      }

      const data = response.getDataTable();
      const row = [];
      for (let col = 0; col < data.getNumberOfColumns(); col++) {
        row.push(data.getValue(0, col));
      }

      sanPham = {
        ten: row[0],
        moTa: row[1],
        gia: row[2],
        anh: row[3]
      };

      document.getElementById('output').innerHTML = `
        <h2>${sanPham.ten}</h2>
        <img src="${sanPham.anh}" alt="${sanPham.ten}" style="max-width:300px; max-height:200px;" />
        <p>${sanPham.moTa}</p>
        <p><strong>Giá: </strong> ${sanPham.gia} đ</p>

        <label>Số lượng: <input type="number" id="soLuong" value="1" min="1" /></label><br/><br/>

        <label>Số điện thoại: <input type="text" id="soDT" placeholder="Nhập số điện thoại" /></label><br/><br/>

        <button onclick="datHang()">Đặt hàng</button>

        <div id="ketQua"></div>
      `;
    }

    function datHang() {
      const soLuong = parseInt(document.getElementById('soLuong').value);
      const soDT = document.getElementById('soDT').value.trim();

      if (!soDT) {
        alert("Vui lòng nhập số điện thoại!");
        return;
      }

      const donHang = {
        tenSanPham: sanPham.ten,
        soLuong: soLuong,
        soDT: soDT
      };

      fetch('https://script.google.com/macros/s/AKfycbypLUkmRXe6mh3Mp3GeQGtQQQHmW8sir4EycVGQ3Ku2VDUnRO1EJCdSV3YjMPO1EJ3E/exec', { // Thay YOUR_WEBAPP_ID bằng ID thật
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(donHang)
      })
      .then(res => res.text())
      .then(txt => {
        document.getElementById('ketQua').innerText = txt;
      })
      .catch(err => {
        document.getElementById('ketQua').innerText = "Lỗi gửi đơn hàng: " + err.message;
      });
    }
  </script>
</head>
<body>
  <h1>Giỏ hàng và Đặt hàng từ Sheet</h1>
  <div id="output">Đang tải dữ liệu sản phẩm...</div>
</body>
</html>
